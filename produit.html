<!-- Add Product Form -->
<form id="add-product-form">
    <input type="text" id="product-name" placeholder="Product Name" required>
    <input type="number" id="product-price" placeholder="Price" required>
    <input type="number" id="product-quantity" placeholder="Quantity" required>
    <button type="submit">Add Product</button>
  </form>
  
  <!-- Products List -->
  <ul id="products-list"></ul>
  
  <script>
     const firebaseConfig = {
apiKey: "AIzaSyDiW8qxDzIYMQmwrwjbCQwmVbdZtbojW-Y",
authDomain: "projet-gestion-depense-budget.firebaseapp.com",
projectId: "projet-gestion-depense-budget",
storageBucket: "projet-gestion-depense-budget.appspot.com",
messagingSenderId: "1053261280689",
appId: "1:1053261280689:web:2afefe516ff5e681e9f990",
measurementId: "G-8SS2X3JYTM"
};

 // Initialize Firebase
 firebase.initializeApp(firebaseConfig);
 const auth = firebase.auth();
 const db = firebase.database();

 

    auth.onAuthStateChanged((user) => {
      if (user) {
        const userId = user.uid;
        
        // Add Product
        document.getElementById('add-product-form').addEventListener('submit', (e) => {
          e.preventDefault();
          const name = document.getElementById('product-name').value;
          const price = document.getElementById('product-price').value;
          const quantity = document.getElementById('product-quantity').value;
          addProduct(userId, name, price, quantity);
        });
  
        // Fetch Products
        db.ref('users/' + userId + '/products').on('value', (snapshot) => {
          const productsList = document.getElementById('products-list');
          productsList.innerHTML = '';
          snapshot.forEach((childSnapshot) => {
            const product = childSnapshot.val();
            const listItem = document.createElement('li');
            listItem.textContent = `${product.name} - ${product.price} - ${product.quantity}`;
            const purchaseButton = document.createElement('button');
            purchaseButton.textContent = 'Mark as Purchased';
            purchaseButton.addEventListener('click', () => {
              markAsPurchased(userId, childSnapshot.key);
            });
            listItem.appendChild(purchaseButton);
            productsList.appendChild(listItem);
          });
        });
      }
    });
  
    function addProduct(userId, name, price, quantity) {
      return db.ref('users/' + userId + '/products').push({
        name: name,
        price: price,
        quantity: quantity,
        purchased: false,
        purchaseDate: null
      });
    }
  
    function markAsPurchased(userId, productId) {
      return db.ref('users/' + userId + '/products/' + productId).update({
        purchased: true,
        purchaseDate: firebase.database.ServerValue.TIMESTAMP
      });
    }
  </script>

<!-- Filter Purchases by Date -->
<form id="filter-purchases-form">
    <input type="date" id="start-date" required>
    <input type="date" id="end-date" required>
    <button type="submit">Filter Purchases</button>
  </form>
  
  <!-- Purchases List -->
  <ul id="purchases-list"></ul>
  
  <script>
    document.getElementById('filter-purchases-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const startDate = new Date(document.getElementById('start-date').value).getTime();
      const endDate = new Date(document.getElementById('end-date').value).getTime();
      getPurchasesByDate(auth.currentUser.uid, startDate, endDate).then((snapshot) => {
        const purchasesList = document.getElementById('purchases-list');
        purchasesList.innerHTML = '';
        snapshot.forEach((childSnapshot) => {
          const product = childSnapshot.val();
          const listItem = document.createElement('li');
          listItem.textContent = `${product.name} - ${product.price} - ${product.quantity} - ${new Date(product.purchaseDate).toLocaleDateString()}`;
          purchasesList.appendChild(listItem);
        });
      });
    });
  
    function getPurchasesByDate(userId, startDate, endDate) {
      return db.ref('users/' + userId + '/products')
        .orderByChild('purchaseDate')
        .startAt(startDate)
        .endAt(endDate)
        .once('value');
    }
  </script>
  